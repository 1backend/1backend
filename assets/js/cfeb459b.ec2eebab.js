"use strict";(self.webpackChunksingulatron_api_docs=self.webpackChunksingulatron_api_docs||[]).push([[2793],{53298:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"built-in-services/secret-svc","title":"Secret Svc","description":"The Secret Svc stores sensitive or internal (non-end-user-facing) configuration. Aims to store all configuration not required at bootstrap, both for internal and external services.","source":"@site/docs/built-in-services/secret-svc.md","sourceDirName":"built-in-services","slug":"/built-in-services/secret-svc","permalink":"/docs/built-in-services/secret-svc","draft":false,"unlisted":false,"editUrl":"https://github.com/1backend/1backend/tree/main/docs-source/docs/built-in-services/secret-svc.md","tags":[{"inline":true,"label":"secret-svc","permalink":"/docs/tags/secret-svc"},{"inline":true,"label":"secrets","permalink":"/docs/tags/secrets"},{"inline":true,"label":"configuration","permalink":"/docs/tags/configuration"},{"inline":true,"label":"services","permalink":"/docs/tags/services"}],"version":"current","sidebarPosition":20,"frontMatter":{"sidebar_position":20,"tags":["secret-svc","secrets","configuration","services"]},"sidebar":"tutorialSidebar","previous":{"title":"User Svc","permalink":"/docs/built-in-services/user-svc"},"next":{"title":"Prompt Svc","permalink":"/docs/built-in-services/prompt-svc"}}');var i=n(74848),t=n(28453);const c={sidebar_position:20,tags:["secret-svc","secrets","configuration","services"]},a="Secret Svc",l={},d=[{value:"Access rules",id:"access-rules",level:2},{value:"Read",id:"read",level:3},{value:"Write",id:"write",level:3},{value:"Create",id:"create",level:4},{value:"Update",id:"update",level:4},{value:"Entities",id:"entities",level:2},{value:"Secret",id:"secret",level:3},{value:"Design choices",id:"design-choices",level:2},{value:"Encryption at rest and transit",id:"encryption-at-rest-and-transit",level:3},{value:"Tips",id:"tips",level:3},{value:"Encrypt",id:"encrypt",level:4},{value:"Checksum",id:"checksum",level:5},{value:"Is Secure",id:"is-secure",level:4}];function o(e){const s={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"secret-svc",children:"Secret Svc"})}),"\n",(0,i.jsx)(s.p,{children:"The Secret Svc stores sensitive or internal (non-end-user-facing) configuration. Aims to store all configuration not required at bootstrap, both for internal and external services."}),"\n",(0,i.jsxs)(s.blockquote,{children:["\n",(0,i.jsxs)(s.p,{children:["This page provides a high-level overview of ",(0,i.jsx)(s.code,{children:"Secret Svc"}),". For detailed information, refer to the ",(0,i.jsx)(s.a,{href:"/docs/1backend/list-secrets",children:"Secret Svc API documentation"}),"."]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"access-rules",children:"Access rules"}),"\n",(0,i.jsx)(s.h3,{id:"read",children:"Read"}),"\n",(0,i.jsxs)(s.p,{children:["Any logged in user who is amongst a ",(0,i.jsx)(s.code,{children:"Secret"}),"'s ",(0,i.jsx)(s.code,{children:"Readers"})," can read a secret."]}),"\n",(0,i.jsx)(s.h3,{id:"write",children:"Write"}),"\n",(0,i.jsx)(s.h4,{id:"create",children:"Create"}),"\n",(0,i.jsx)(s.p,{children:"Any logged in user can create a secret. Non-admin users can only create secrets with the key prefixed by their slug, ie:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:"deploy-svc/EXAMPLE-KEY\n"})}),"\n",(0,i.jsx)(s.p,{children:"vs non-prefixed keys such as"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:"EMAIL_API_KEY\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Non-prefixed keys like ",(0,i.jsx)(s.code,{children:"EMAIL_API_KEY"})," can only be created by admin users."]}),"\n",(0,i.jsx)(s.p,{children:"This prefix rule serves two purposes:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:'It is clear which secret keys are "static" and originating from admin users'}),"\n",(0,i.jsx)(s.li,{children:"It can prevent issues where a user claims a key knowing that it might be used later and overwritten/populated by an admin with sensitive information"}),"\n"]}),"\n",(0,i.jsx)(s.h4,{id:"update",children:"Update"}),"\n",(0,i.jsxs)(s.p,{children:["After a key is created further write access is governed by the ",(0,i.jsx)(s.code,{children:"Writers"})," block."]}),"\n",(0,i.jsx)(s.h2,{id:"entities",children:"Entities"}),"\n",(0,i.jsx)(s.h3,{id:"secret",children:"Secret"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-yaml",children:'id: "secr_eG8IvKwB0A"\nkey: "MY_API_KEY"\nvalue: "nNl4X9+@95Z"\n\n# Slugs of services and users who can read the secret\nreaders:\n  - "alice"\n  - "bob"\n\n# Slugs of services and users who can modify the secret\nwriters:\n  - "alice"\n  - "bob"\n\n# Slugs of services and users who can delete the secret\ndeleters:\n  - "service-admin"\n\n# Slugs of services and users who can change the "readers" list\ncanChangeReaders:\n  - "alice"\n\n# Slugs of services and users who can change the "writers" list\ncanChangeWriters:\n  - "alice"\n\n# Slugs of services and users who can change the "deleters" list\ncanChangeDeleters:\n  - "alice"\n'})}),"\n",(0,i.jsx)(s.h2,{id:"design-choices",children:"Design choices"}),"\n",(0,i.jsx)(s.p,{children:"The Secret Svc, like most things in 1Backend, is designed to be simple to reason about."}),"\n",(0,i.jsx)(s.p,{children:"Instead of the 1Backend injecting environment variables into service containers when they are deployed, the services are left to their own devices to read secrets from the Secret Svc through normal service calls, using their credentials."}),"\n",(0,i.jsx)(s.p,{children:"This approach also works for services that you deploy manually (e.g., Kubernetes, Docker Compose) rather than through 1Backend."}),"\n",(0,i.jsx)(s.h3,{id:"encryption-at-rest-and-transit",children:"Encryption at rest and transit"}),"\n",(0,i.jsxs)(s.p,{children:["All data is encrypted using the encryption key provided by the envar ",(0,i.jsx)(s.code,{children:"OPENORCH_ENCRYPTION_KEY"})," (see Todo section)."]}),"\n",(0,i.jsx)(s.p,{children:"The server encrypts the secret values before saving them to disk/DB. The secret values are transmitted to readers unencrypted."}),"\n",(0,i.jsx)(s.h3,{id:"tips",children:"Tips"}),"\n",(0,i.jsx)(s.h4,{id:"encrypt",children:"Encrypt"}),"\n",(0,i.jsx)(s.p,{children:"The encrypt command helps you create encrypted YAML files that can be safely stored in source control and integrated into Infrastructure-as-Code (IaC) or GitOps workflows. This ensures sensitive data is protected while enabling automated deployment processes."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:"$ oo secret encrypt example-key example-value\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-yaml",children:'id: "secr_eR6LbYOBK2"\nkey: "example-key"\nvalue: "62bQMQf5wPMrAsJ7+bcZpKBMtA7Ap7DF6xZaioq9jU0="\nencrypted: true\nchecksum: "45a3b25f"\nchecksumAlgorithm: "CRC32"\n'})}),"\n",(0,i.jsx)(s.p,{children:"Save the output to a file and, in your continuous delivery pipeline, apply it:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:"$ oo secret save my-api-key.yaml\n"})}),"\n",(0,i.jsx)(s.h5,{id:"checksum",children:"Checksum"}),"\n",(0,i.jsx)(s.p,{children:"Checksums are optional and serve to verify the integrity of encrypted values. When an already encrypted value is saved in the Secret Svc, the service decodes it and uses the checksum to ensure the value remains intact."}),"\n",(0,i.jsx)(s.h4,{id:"is-secure",children:"Is Secure"}),"\n",(0,i.jsx)(s.p,{children:"After setting up your daemon it's a good idea to check if the Secret Svc is secure:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:"$ oo secret is-secure\nService is secure.\n"})}),"\n",(0,i.jsx)(s.p,{children:"This will return successfully if the encryption key has been changed from the default value and all necessary setup steps have been completed."})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}}}]);