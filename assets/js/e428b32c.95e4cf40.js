"use strict";(self.webpackChunksingulatron_api_docs=self.webpackChunksingulatron_api_docs||[]).push([[4830],{47956:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"built-in-services/user-svc","title":"User Svc","description":"The user service is at the heart of 1Backend, managing users, tokens, organizations, permissions and more. Each service and human on an 1Backend network has an account in the User Svc.","source":"@site/docs/built-in-services/user-svc.md","sourceDirName":"built-in-services","slug":"/built-in-services/user-svc","permalink":"/docs/built-in-services/user-svc","draft":false,"unlisted":false,"editUrl":"https://github.com/1backend/1backend/tree/main/docs-source/docs/built-in-services/user-svc.md","tags":[{"inline":true,"label":"user-svc","permalink":"/docs/tags/user-svc"},{"inline":true,"label":"permissions","permalink":"/docs/tags/permissions"},{"inline":true,"label":"roles","permalink":"/docs/tags/roles"},{"inline":true,"label":"authentication","permalink":"/docs/tags/authentication"},{"inline":true,"label":"authorization","permalink":"/docs/tags/authorization"},{"inline":true,"label":"service","permalink":"/docs/tags/service"},{"inline":true,"label":"service to service calls","permalink":"/docs/tags/service-to-service-calls"},{"inline":true,"label":"s2s calls","permalink":"/docs/tags/s-2-s-calls"},{"inline":true,"label":"multitenant","permalink":"/docs/tags/multitenant"}],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10,"tags":["user-svc","permissions","roles","authentication","authorization","service","service to service calls","s2s calls","multitenant"]},"sidebar":"tutorialSidebar","previous":{"title":"Built-in services","permalink":"/docs/category/built-in-services"},"next":{"title":"Proxy Svc","permalink":"/docs/built-in-services/proxy-svc"}}');var r=n(74848),o=n(28453);const t={sidebar_position:10,tags:["user-svc","permissions","roles","authentication","authorization","service","service to service calls","s2s calls","multitenant"]},a="User Svc",l={},c=[{value:"Glossary",id:"glossary",level:2},{value:"Overview",id:"overview",level:2},{value:"Permits",id:"permits",level:2},{value:"Auth patterns",id:"auth-patterns",level:2},{value:"Role-based access",id:"role-based-access",level:3},{value:"Permission-based access",id:"permission-based-access",level:3},{value:"Tokens",id:"tokens",level:2},{value:"Verifying a token",id:"verifying-a-token",level:3},{value:"Automatic token refresh",id:"automatic-token-refresh",level:3},{value:"Example flow",id:"example-flow",level:4},{value:"Token Pruning",id:"token-pruning",level:4},{value:"Token structure",id:"token-structure",level:3},{value:"Roles",id:"roles",level:2},{value:"Roles without permissions",id:"roles-without-permissions",level:3},{value:"Roles containing dynamic data",id:"roles-containing-dynamic-data",level:3},{value:"Owning roles vs. just having them",id:"owning-roles-vs-just-having-them",level:3},{value:"What does it mean to own a role?",id:"what-does-it-mean-to-own-a-role",level:4},{value:"\u2705 1. You created it (slug-based ownership)",id:"-1-you-created-it-slug-based-ownership",level:4},{value:"\u2705 2. You\u2019re an admin of that role family",id:"-2-youre-an-admin-of-that-role-family",level:4},{value:"Why role ownership matters",id:"why-role-ownership-matters",level:4},{value:"Enrolls",id:"enrolls",level:2},{value:"Organizations",id:"organizations",level:2},{value:"Organizations and apps",id:"organizations-and-apps",level:3},{value:"Access rules",id:"access-rules",level:3},{value:"Create",id:"create",level:4},{value:"Membership",id:"membership",level:2},{value:"Permissions",id:"permissions",level:2},{value:"Permission access rules",id:"permission-access-rules",level:3},{value:"Permission examples",id:"permission-examples",level:4},{value:"Services with multiple nodes",id:"services-with-multiple-nodes",level:2},{value:"Apps",id:"apps",level:2},{value:"CLI Reference",id:"cli-reference",level:2},{value:"Quick Start",id:"quick-start",level:3},{value:"Authentication Commands",id:"authentication-commands",level:3},{value:"<code>oo register</code> - Create New Accounts",id:"oo-register---create-new-accounts",level:4},{value:"<code>oo login</code> - Authenticate",id:"oo-login---authenticate",level:4},{value:"<code>oo whoami</code> - Identity Information",id:"oo-whoami---identity-information",level:4},{value:"<code>oo use</code> - Switch User Context",id:"oo-use---switch-user-context",level:4},{value:"<code>oo token</code> - Access Tokens",id:"oo-token---access-tokens",level:4},{value:"User Management Commands",id:"user-management-commands",level:3},{value:"<code>oo user list</code> - Browse Users",id:"oo-user-list---browse-users",level:4},{value:"Permission Management",id:"permission-management",level:3},{value:"<code>oo permit save</code> - Grant Permissions",id:"oo-permit-save---grant-permissions",level:4},{value:"<code>oo permit list</code> - View Permissions",id:"oo-permit-list---view-permissions",level:4},{value:"Enrollment",id:"enrollment",level:3},{value:"<code>oo enroll save</code> - Assign Roles",id:"oo-enroll-save---assign-roles",level:4},{value:"<code>oo enroll list</code> - View Enrollments",id:"oo-enroll-list---view-enrollments",level:4}];function d(e){const s={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"user-svc",children:"User Svc"})}),"\n",(0,r.jsxs)(s.p,{children:["The user service is at the heart of 1Backend, managing users, tokens, organizations, permissions and more. Each service and human on an 1Backend network has an account in the ",(0,r.jsx)(s.code,{children:"User Svc"}),"."]}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.p,{children:["This page provides a high-level overview of ",(0,r.jsx)(s.code,{children:"User Svc"}),". For detailed information, refer to the ",(0,r.jsx)(s.a,{href:"/docs/1backend-api/login",children:"User Svc API documentation"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:['User Svc supports multitenancy: while users are shared globally, tokens, organizations, permits, enrollments, and memberships are isolated by an "app" field (see ',(0,r.jsx)(s.code,{children:"Apps"})," section on this page). This approach allows a single 1Backend instance to securely support multiple web applications."]}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.p,{children:["Note: Not all services included with 1Backend may support multitenancy. Please refer to the documentation for details and look for the tag ",(0,r.jsx)(s.code,{children:"multitenant"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"glossary",children:"Glossary"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.a,{href:"#tokens",children:"Token"})}),": A JWT (JSON Web Token) issued and signed by the User Svc, used to authenticate both human and service accounts."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.a,{href:"#roles",children:"Role"})}),": A simple string identifier like ",(0,r.jsx)(s.code,{children:"user-svc:user"})," or ",(0,r.jsx)(s.code,{children:"user-svc:org:{orgId}:admin"})," that represents a specific capability or access level. Roles are embedded in tokens."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.a,{href:"#enrolls",children:"Enroll"})}),": (Enrollment) A mechanism to assign roles to users\u2014both current and future. Enrolls allow roles to be claimed later, once the user joins or logs in."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.a,{href:"#permissions",children:"Permission"})}),": A string such as ",(0,r.jsx)(s.code,{children:"petstore-svc:read"}),", typically mapping to an API action or endpoint. Roles can bundle multiple permissions."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.a,{href:"#permits",children:"Permit"})}),": A mechanism for assigning permissions to users or roles. Permits define who can access what by connecting users or roles with specific permissions."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.a,{href:"#organizations",children:"Organization"})}),": A way for users to freely associate with each other. Anyone can create organizations and grant membership to others to their organization."]}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.a,{href:"#membership",children:"Membership"})}),": A formal record that links a user to an organization. Memberships determine which organizations a user belongs to and enable organization-scoped roles to take effect."]}),"\n",(0,r.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(s.p,{children:"The most important thing about the User Svc is that service (machine) and user (human) accounts look and function the same."}),"\n",(0,r.jsxs)(s.p,{children:["Every service you write needs to ",(0,r.jsx)(s.a,{href:"/docs/1backend-api/register",children:"register"})," at startup, or ",(0,r.jsx)(s.a,{href:"/docs/1backend-api/login",children:"log in"})," with the credentials it saves and manages if it's already registered. Just like a human."]}),"\n",(0,r.jsx)(s.p,{children:"A service account is not an admin account, it's a simple user level account. You might wonder how service-to-service calls work then. The answer is permits."}),"\n",(0,r.jsx)(s.h2,{id:"permits",children:"Permits"}),"\n",(0,r.jsx)(s.p,{children:"Most endpoints on 1Backend can only be called by administrators by default."}),"\n",(0,r.jsxs)(s.p,{children:["Let's take prompting. If you want to let your users prompt AIs you might write a wrapper service called ",(0,r.jsx)(s.code,{children:"User Prompter Svc"})," with the slug ",(0,r.jsx)(s.code,{children:"user-prompter-svc"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["If we look at the ",(0,r.jsx)(s.a,{href:"/docs/1backend-api/prompt",children:"Add Prompt endpoint API docs"}),", we can see that it mentions"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"Requires the `prompt-svc:prompt:create` permission.\n"})}),"\n",(0,r.jsx)(s.p,{children:"To enable your service to call the Add Prompt endpoint, we need to create a permit with your service slug and the permission mentioned above:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'id: "user-prompter-permit"\npermissionId: "prompt-svc:prompt:create"\nslugs:\n  - "user-prompter-svc"\n'})}),"\n",(0,r.jsxs)(s.p,{children:["You can apply these permits with an administrator account in your CI workflow with the ",(0,r.jsx)(s.code,{children:"oo"})," CLI:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sh",children:"oo permit save user-prompter-permit.yaml\n"})}),"\n",(0,r.jsx)(s.h2,{id:"auth-patterns",children:"Auth patterns"}),"\n",(0,r.jsx)(s.h3,{id:"role-based-access",children:"Role-based access"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Role-Only Checks"}),": Authorize users based solely on their assigned roles. This is the simplest method\u2014no need to check individual permissions."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"permission-based-access",children:"Permission-based access"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"API Permission Check"}),": Use the ",(0,r.jsx)(s.code,{children:"Has Permission"})," endpoint with the user's authentication headers and a permission ID to verify access dynamically. This endpoint is designed to be easy to cache (it has no other params apart from the caller header and a permission)."]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"Permission-based checks offer more nuanced control than simple role-only checks\u2014permits can grant specific permissions to slugs, roles and more."}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsxs)(s.p,{children:["If you are looking at restricting access to endpoints in other ways, you might be interested in: ",(0,r.jsx)(s.a,{href:"/docs/built-in-services/policy-svc",children:"Policy Svc"}),"."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"tokens",children:"Tokens"}),"\n",(0,r.jsxs)(s.p,{children:["The User Svc produces a JWT (",(0,r.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/JSON_Web_Token",children:"JSON Web Token"}),") upon ",(0,r.jsx)(s.a,{href:"/docs/1backend-api/login",children:"/user-svc/login"})," in the ",(0,r.jsx)(s.code,{children:"token.token"})," field (see the response documentation)."]}),"\n",(0,r.jsxs)(s.p,{children:["You can either use this token as a proper JWT - parse it and inspect the contents, or you can just use the token to read the user account that belongs to the token with the ",(0,r.jsx)(s.a,{href:"/docs/1backend-api/read-self",children:"/user-svc/self"})," endpoint."]}),"\n",(0,r.jsx)(s.h3,{id:"verifying-a-token",children:"Verifying a token"}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.a,{href:"/docs/1backend-api/get-public-key",children:(0,r.jsx)(s.code,{children:"/user-svc/public-key"})})," will return you the public key of the User Svc which then you can use that to verify the token."]}),"\n",(0,r.jsxs)(s.p,{children:["Use the JWT libraries that are available in your programming language to do that, or use the Singularon ",(0,r.jsx)(s.a,{href:"https://github.com/1backend/1backend/tree/main/sdk",children:"SDK"})," if your language is supported."]}),"\n",(0,r.jsx)(s.h3,{id:"automatic-token-refresh",children:"Automatic token refresh"}),"\n",(0,r.jsxs)(s.p,{children:["1Backend tokens are valid for a limited time (see ",(0,r.jsx)(s.code,{children:"OB_TOKEN_EXPIRATION"}),"). Once a token expires, 1Backend can either automatically refresh it (this is the default behaviour) or reject it based on configuration (see ",(0,r.jsx)(s.code,{children:"OB_TOKEN_AUTO_REFRESH_OFF"}),")."]}),"\n",(0,r.jsx)(s.p,{children:"If automatic token refresh is disabled, clients are responsible for detecting expiration and refreshing the token themselves."}),"\n",(0,r.jsx)(s.p,{children:"If automatic refresh is enabled, expired tokens can still be reused indefinitely. Behind the scenes, 1Backend maps old tokens to their most recent valid version."}),"\n",(0,r.jsx)(s.h4,{id:"example-flow",children:"Example flow"}),"\n",(0,r.jsx)(s.p,{children:"To understand how automatic token refresh works in practice, consider the following scenario:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"A user acquires a token."}),"\n",(0,r.jsx)(s.li,{children:"The token is valid for X minutes."}),"\n",(0,r.jsx)(s.li,{children:"After expiration, Service A receives a request with the old token."}),"\n",(0,r.jsxs)(s.li,{children:["Service A then has two options:","\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Call the User Svc RefreshToken endpoint on every request to get a new token \u2014 which undermines the stateless nature of JWTs."}),"\n",(0,r.jsx)(s.li,{children:"Cache the refreshed token and continue accepting the expired one, internally mapping it to the latest valid token without calling 1Backend. When the refreshed token expires, this process repeats."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.h4,{id:"token-pruning",children:"Token Pruning"}),"\n",(0,r.jsxs)(s.p,{children:["You might wonder: if an old token keeps getting refreshed indefinitely, does that mean a new token is minted every ",(0,r.jsx)(s.code,{children:"OB_TOKEN_EXPIRATION"})," interval \u2014 and do they pile up forever?"]}),"\n",(0,r.jsxs)(s.p,{children:["While a new token is issued on each refresh, the system keeps track of which tokens are actively being refreshed and discards the rest. At any given time, a maximum of ",(0,r.jsx)(s.strong,{children:"three tokens per device"})," (see the ",(0,r.jsx)(s.code,{children:"device"})," field in the token) are retained:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"The currently active token"}),"\n",(0,r.jsx)(s.li,{children:"The two most recently refreshed tokens (kept as a buffer to handle clock drift or retries)"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"All other older tokens are pruned to avoid unbounded growth."}),"\n",(0,r.jsx)(s.h3,{id:"token-structure",children:"Token structure"}),"\n",(0,r.jsx)(s.p,{children:"The structure of the JWT is the following:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"# User Id\noui: usr_dC4K75Cbp6\n\n# Slug\nosl: test-user-slug-0\n\n# Roles\noro:\n  - user-svc:user\n  - user-svc:org:{org_dC4K7NNDCG}:user\n"})}),"\n",(0,r.jsx)(s.p,{children:"The field names are kept short to save space, so perhaps the Go definition is also educational:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-go",children:'type Claims struct {\n UserId  string   `json:"oui"` // `oui`: 1backend user ids\n Slug    string   `json:"osl"` // `osl`: 1backend slug\n Roles []string   `json:"oro"` // `oro`: 1backend roles\n jwt.RegisteredClaims\n}\n'})}),"\n",(0,r.jsx)(s.h2,{id:"roles",children:"Roles"}),"\n",(0,r.jsxs)(s.p,{children:["Roles are simply strings. They are not a database record, they don't have an ID, name etc. They are simple strings, such as ",(0,r.jsx)(s.code,{children:"user-svc:admin"}),"."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"# Roles are not a database entity.\n"})}),"\n",(0,r.jsx)(s.p,{children:"A user token produced upon login contains all the roles a user has."}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsx)(s.p,{children:"Efficiency Tip: JWT tokens are sent with every request. Keeping the number of roles minimal improves performance."}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"When checking if a user is authorized, there are a few common patterns to choose from:"}),"\n",(0,r.jsx)(s.h3,{id:"roles-without-permissions",children:"Roles without permissions"}),"\n",(0,r.jsx)(s.p,{children:"Roles are powerful, even without specific permissions attached. One common use case is managing product subscriptions."}),"\n",(0,r.jsx)(s.p,{children:"Suppose you launch a new product called Funny Cats Newsletter with two subscription tiers: Pro and Ultra. You could create a service with the slug funny-cats-newsletter-svc and define custom static roles for each tier:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"funny-cats-newsletter-svc:pro\nfunny-cats-newsletter-svc:ultra\n"})}),"\n",(0,r.jsx)(s.p,{children:"By checking if these roles exist in a user's token, you can authorize access to product-specific features. These roles can be created dynamically by calling the Create Role endpoint."}),"\n",(0,r.jsx)(s.h3,{id:"roles-containing-dynamic-data",children:"Roles containing dynamic data"}),"\n",(0,r.jsx)(s.p,{children:"You are free to make up your own roles which might even have dynamic data, just like the User Svc did with the organization ids."}),"\n",(0,r.jsx)(s.p,{children:"Example:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-sh",children:"user-svc:org:{org_dBZRCej3fo}:admin\nuser-svc:org:{org_dBZRCej3fo}:user\n"})}),"\n",(0,r.jsxs)(s.p,{children:["By convention these dynamic values are enclosed in ",". In this example, roles are assigned per organization. For more details, see the Organizations section."]}),"\n",(0,r.jsx)(s.h3,{id:"owning-roles-vs-just-having-them",children:"Owning roles vs. just having them"}),"\n",(0,r.jsxs)(s.p,{children:["When managing roles in 1Backend (especially through actions like ",(0,r.jsx)(s.code,{children:"SaveEnrolls"}),"), it's important to understand a key distinction:"]}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsx)(s.p,{children:(0,r.jsxs)(s.strong,{children:["Just because you ",(0,r.jsx)(s.em,{children:"have"})," a role doesn\u2019t mean you can ",(0,r.jsx)(s.em,{children:"assign"})," that role to others."]})}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["For example, if an admin gives you the role ",(0,r.jsx)(s.code,{children:"user-svc:org:acme:user"}),", that doesn\u2019t mean you can turn around and give it to someone else. Only certain users or services can assign roles\u2014they need to ",(0,r.jsx)(s.strong,{children:"own"})," them."]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"what-does-it-mean-to-own-a-role",children:"What does it mean to own a role?"}),"\n",(0,r.jsxs)(s.p,{children:["A user (or service) ",(0,r.jsx)(s.em,{children:"owns"})," a role if ",(0,r.jsx)(s.strong,{children:"either"})," of the following is true:"]}),"\n",(0,r.jsx)(s.h4,{id:"-1-you-created-it-slug-based-ownership",children:"\u2705 1. You created it (slug-based ownership)"}),"\n",(0,r.jsx)(s.p,{children:"If a role starts with your slug, you automatically own it."}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Example:"})}),"\n",(0,r.jsxs)(s.p,{children:["If your slug is ",(0,r.jsx)(s.code,{children:"funny-cats-svc"}),", then you own roles like:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"funny-cats-svc:pro"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"funny-cats-svc:ultra"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"funny-cats-svc:admin"})}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"These roles are yours \u2014 you can assign them, modify them, or revoke them."}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h4,{id:"-2-youre-an-admin-of-that-role-family",children:"\u2705 2. You\u2019re an admin of that role family"}),"\n",(0,r.jsxs)(s.p,{children:["If you hold a role like ",(0,r.jsx)(s.code,{children:"user-svc:org:{org_id}:admin"}),", then you also ",(0,r.jsx)(s.strong,{children:"own"})," other roles that share the same prefix."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Example:"})}),"\n",(0,r.jsx)(s.p,{children:"If you have:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"user-svc:org:org_xyz123:admin\n"})}),"\n",(0,r.jsx)(s.p,{children:"Then you also own:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"user-svc:org:org_xyz123:user"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.code,{children:"user-svc:org:org_xyz123:viewer"})}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"That means you're authorized to assign those roles to others."}),"\n",(0,r.jsx)(s.h4,{id:"why-role-ownership-matters",children:"Why role ownership matters"}),"\n",(0,r.jsxs)(s.p,{children:["This ownership rule prevents ",(0,r.jsx)(s.strong,{children:"privilege escalation"}),"."]}),"\n",(0,r.jsx)(s.p,{children:"Without this rule, anyone with a role could assign it to others \u2014 even roles they shouldn\u2019t control. Enforcing ownership ensures only trusted users or services can delegate access."}),"\n",(0,r.jsx)(s.h2,{id:"enrolls",children:"Enrolls"}),"\n",(0,r.jsx)(s.p,{children:"Enrollments are a flexible way to assign roles to users, whether they already exist in the system or will be joining later. They enable role pre-assignment, which means users receive roles as soon as they register or log in, based on matching criteria like email."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'# Enrollment through contact ID\nid: "admin-enrollment-1"\nrole: "user-svc:admin"\ncontactId: "admin@company.com"\n'})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'# Enrollment through user ID\nid: "payment-processor-enrollment"\nrole: "payment-svc:processor"\nuserId: "usr_abc123"\n'})}),"\n",(0,r.jsxs)(s.p,{children:["For CLI usage see ",(0,r.jsx)(s.a,{href:"#enrollment",children:"this section"}),"."]}),"\n",(0,r.jsx)(s.h2,{id:"organizations",children:"Organizations"}),"\n",(0,r.jsx)(s.p,{children:"Organizations provide a way for users to group together and collaborate. Think of them as user-defined domains of trust\u2014similar to GitHub organizations, Slack workspaces, or Discord servers. They enable structured permissioning and scoped roles within a 1Backend application."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'id: "org_eZqC0BbdG2"\nname: "Acme Corporation" # Full name of the organization\nslug: "acme-corporation" # URL-friendly unique identifier for the organization\ncreatedAt: "2025-01-15T12:00:00Z" # Example ISO 8601 timestamp\n'})}),"\n",(0,r.jsx)(s.h3,{id:"organizations-and-apps",children:"Organizations and apps"}),"\n",(0,r.jsx)(s.p,{children:"Organizations belong to a specific app. Even if the same user is part of multiple apps, their roles and memberships in one app don\u2019t carry over to another. This ensures that each app has its own separate set of organizations, users, and permissions\u2014cleanly isolated and secure."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"                                 +-------------------+\n                                 |     User Svc      |\n                                 |  (Shared Users)   |\n                                 +---------+---------+\n                                           |\n                   +-----------------------+----------------------+\n                   |                                              |\n            +------+-------+                              +-------+------+\n            |     App A     |                              |     App B    |\n            |  (socks.com)  |                              |  (shoes.com) |\n            +------+--------+                              +-------+------+\n                   |                                                |\n        +----------+----------+                        +------------+-----------+\n        |                     |                        |                        |\n+-------+-------+     +-------+-------+        +-------+--------+      +--------+-------+\n|  Org A1       |     |  Org A2       |        |  Org B1        |      |  Org B2        |\n+-------+-------+     +-------+-------+        +--------+--------+      +--------+-------+\n"})}),"\n",(0,r.jsx)(s.p,{children:"Notes:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["All users are stored centrally in ",(0,r.jsx)(s.strong,{children:"User Svc"}),", but each ",(0,r.jsx)(s.strong,{children:"App"}),' provides isolated "worlds".']}),"\n",(0,r.jsxs)(s.li,{children:["Each ",(0,r.jsx)(s.strong,{children:"App"})," contains independent ",(0,r.jsx)(s.strong,{children:"Organizations"}),", ",(0,r.jsx)(s.strong,{children:"Memberships"}),", and ",(0,r.jsx)(s.strong,{children:"Roles"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["A ",(0,r.jsx)(s.strong,{children:"User"})," can belong to multiple ",(0,r.jsx)(s.strong,{children:"Apps"})," and ",(0,r.jsx)(s.strong,{children:"Organizations"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Authentication logic"})," respect app boundaries via the ",(0,r.jsx)(s.code,{children:"app"})," field in the token."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"access-rules",children:"Access rules"}),"\n",(0,r.jsx)(s.h4,{id:"create",children:"Create"}),"\n",(0,r.jsxs)(s.p,{children:["Any logged in user can create an organization, provided the ",(0,r.jsx)(s.code,{children:"Organization"})," slug is not taken yet. The creator becomes the first admin of the organization, acquiring the role of ",(0,r.jsx)(s.code,{children:"user-svc:org:{orgId}:admin"})," role."]}),"\n",(0,r.jsx)(s.h2,{id:"membership",children:"Membership"}),"\n",(0,r.jsxs)(s.p,{children:["A membership is a formal link between a user and an organization. It determines what organizations a user belongs to and enables organization-scoped roles to take effect (such as ",(0,r.jsx)(s.code,{children:"user-svc:org:{orgId}:user"})," or ",(0,r.jsx)(s.code,{children:"user-svc:org:{orgId}:admin"}),")."]}),"\n",(0,r.jsxs)(s.p,{children:["Similarly how ",(0,r.jsx)(s.a,{href:"#enrolls",children:(0,r.jsx)(s.code,{children:"Enrolls"})})," add roles to users, Memberships add users to organizations. Memberships are created by the ",(0,r.jsx)(s.a,{href:"/docs/1backend-api/save-enrolls",children:(0,r.jsx)(s.code,{children:"SaveEnrolls"})})," endpoint, which allows you to assign roles to users based on their organization membership."]}),"\n",(0,r.jsx)(s.h2,{id:"permissions",children:"Permissions"}),"\n",(0,r.jsxs)(s.p,{children:["A permission is a simple string that represents a specific capability or access right within your service\u2014e.g., ",(0,r.jsx)(s.code,{children:"petstore-svc:pet:create"}),", ",(0,r.jsx)(s.code,{children:"payment-svc:process"}),", or ",(0,r.jsx)(s.code,{children:"chat-svc:message:read"}),". Permissions are purely convention-based and aren't backed by a database entity. They are just strings\u2014but they become powerful when combined with permits."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"# Permissions are not a database entity.\n"})}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsx)(s.p,{children:"Permissions typically correspond to protected API actions. They're meant to be human-readable and composable."}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Permissions alone don\u2019t do anything. To make a permission meaningful, you must grant it to someone\u2014either a user or a role. This is done by creating a ",(0,r.jsx)(s.a,{href:"#permits",children:(0,r.jsx)(s.code,{children:"Permit"})}),"."]}),"\n",(0,r.jsx)(s.p,{children:"Permits are the glue between permissions, roles, and service slugs."}),"\n",(0,r.jsx)(s.h3,{id:"permission-access-rules",children:"Permission access rules"}),"\n",(0,r.jsx)(s.p,{children:"Each permission created must by prefixed by the slug of the account that created it. Said account becomes the owner of the permission and only that account can add the permission to a role."}),"\n",(0,r.jsxs)(s.blockquote,{children:["\n",(0,r.jsx)(s.p,{children:"Once you (your service) own a permission (by creating it, and it being prefixed by your account slug), you can add it to any role, not just roles owned by you."}),"\n"]}),"\n",(0,r.jsx)(s.h4,{id:"permission-examples",children:"Permission examples"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Permission"}),(0,r.jsx)(s.th,{children:"Purpose"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"petstore-svc:pet:read"})}),(0,r.jsx)(s.td,{children:"View pet data"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"petstore-svc:pet:create"})}),(0,r.jsx)(s.td,{children:"Add new pets"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"petstore-svc:pet:delete"})}),(0,r.jsx)(s.td,{children:"Remove pets from the system"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"petstore-svc:appointment:book"})}),(0,r.jsx)(s.td,{children:"Book appointments for pets"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"petstore-svc:appointment:cancel"})}),(0,r.jsx)(s.td,{children:"Cancel appointments"})]})]})]}),"\n",(0,r.jsx)(s.hr,{}),"\n",(0,r.jsx)(s.h2,{id:"services-with-multiple-nodes",children:"Services with multiple nodes"}),"\n",(0,r.jsxs)(s.p,{children:['You might now wonder what happens when a service has multiple instances/nodes. Won\'t their user accounts "clash" in the ',(0,r.jsx)(s.code,{children:"User Svc"}),"? The answer to this is that from the ",(0,r.jsx)(s.code,{children:"User Svc"})," point of view, each node/instance of a service is the same account."]}),"\n",(0,r.jsx)(s.p,{children:'This is possible because the platform is designed with services having a "Shared Database Access".'}),"\n",(0,r.jsxs)(s.p,{children:["Let's say you have a Cassandra network that spans multiple Availability Zones/Regions. Your nodes will also span multiple AZs/Regions and each instance of them will log in as ",(0,r.jsx)(s.code,{children:"X Svc"}),"."]}),"\n",(0,r.jsx)(s.h2,{id:"apps",children:"Apps"}),"\n",(0,r.jsx)(s.p,{children:"Apps are the foundation of multitenancy in 1Backend. They act as namespaces that allow you to serve multiple clients, projects, or websites using the same set of microservices."}),"\n",(0,r.jsxs)(s.p,{children:["It\u2019s recommended to use the website's hostname (e.g., ",(0,r.jsx)(s.code,{children:"socks.com"}),", ",(0,r.jsx)(s.code,{children:"shoes.com"}),") as the app name. This helps clearly separate environments while remaining easy to manage."]}),"\n",(0,r.jsx)(s.p,{children:'The current app is typically inferred from the authentication token. For public endpoints, it\u2019s derived from the request host. As a result, even if a service API doesn\u2019t explicitly mention "App" in its endpoints, it might still support multitenancy.'}),"\n",(0,r.jsxs)(s.p,{children:["On this documentation page, services marked with the ",(0,r.jsx)(s.code,{children:"multitenancy"})," tag\u2014such as ",(0,r.jsx)(s.strong,{children:"User Svc"}),", ",(0,r.jsx)(s.strong,{children:"Config Svc"}),", and ",(0,r.jsx)(s.strong,{children:"Secret Svc"}),"\u2014support apps. These services provide the essential building blocks for building robust, multi-tenant applications."]}),"\n",(0,r.jsx)(s.h2,{id:"cli-reference",children:"CLI Reference"}),"\n",(0,r.jsx)(s.h3,{id:"quick-start",children:"Quick Start"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Register a new user\noo register alice\nEnter password: [hidden]\n\n# Login with existing credentials\noo login alice\nEnter password: [hidden]\n\n# Check current authentication status\noo whoami\n\n# View authentication token\noo token\n\n# Switch between users (if multiple logged in)\noo use bob\n"})}),"\n",(0,r.jsx)(s.h3,{id:"authentication-commands",children:"Authentication Commands"}),"\n",(0,r.jsxs)(s.h4,{id:"oo-register---create-new-accounts",children:[(0,r.jsx)(s.code,{children:"oo register"})," - Create New Accounts"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Usage:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"oo register [slug] [password]\n# or\noo register [slug]\nEnter password: [hidden]\n\noo register [--contact-id email] [--contact-platform email]\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Examples:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Interactive registration (secure - no terminal history)\noo register alice\nEnter password: [hidden]\n\n# User with contact information\noo register john-doe --contact-id john@company.com --contact-platform email\n\n# Direct registration (automation only - avoid for security)\noo register test-user test-password\n"})}),"\n",(0,r.jsxs)(s.h4,{id:"oo-login---authenticate",children:[(0,r.jsx)(s.code,{children:"oo login"})," - Authenticate"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Usage:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"oo login [slug] [password]\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Examples:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Interactive login (recommended)\noo login alice\nEnter password: [hidden]\n\n# Quick development login (avoid in production)\noo login dev-user dev-password\n"})}),"\n",(0,r.jsxs)(s.h4,{id:"oo-whoami---identity-information",children:[(0,r.jsx)(s.code,{children:"oo whoami"})," - Identity Information"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Usage:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"oo whoami [--all]\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Examples:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Current user information\noo whoami\n\n# All logged in users\noo whoami --all\n\n# Example output:\n# id: usr_abc123\n# slug: alice\n# roles:\n#   - user-svc:user\n#   - user-svc:org:org_xyz789:admin\n#   - payment-svc:processor\n"})}),"\n",(0,r.jsxs)(s.h4,{id:"oo-use---switch-user-context",children:[(0,r.jsx)(s.code,{children:"oo use"})," - Switch User Context"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Examples:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Switch to different authenticated user\noo use payment-svc\noo use alice\noo use admin-user\n\n# Verify switch\noo whoami\n"})}),"\n",(0,r.jsxs)(s.h4,{id:"oo-token---access-tokens",children:[(0,r.jsx)(s.code,{children:"oo token"})," - Access Tokens"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'# Get current authentication token\noo token\n\n# Use in API calls\ncurl -H "Authorization: Bearer $(oo token)" \\\n  https://api.1backend.com/user-svc/self\n'})}),"\n",(0,r.jsx)(s.h3,{id:"user-management-commands",children:"User Management Commands"}),"\n",(0,r.jsxs)(s.h4,{id:"oo-user-list---browse-users",children:[(0,r.jsx)(s.code,{children:"oo user list"})," - Browse Users"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Usage:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"oo user list [--userId id] [--contactId email] [--limit count]\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Examples:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# List all users (admin required)\noo user list\n\n# Find specific user\noo user list --userId usr_abc123\n\n# Find by email\noo user list --contactId alice@company.com\n\n# Paginated results\noo user list --limit 50\n"})}),"\n",(0,r.jsx)(s.h3,{id:"permission-management",children:"Permission Management"}),"\n",(0,r.jsxs)(s.h4,{id:"oo-permit-save---grant-permissions",children:[(0,r.jsx)(s.code,{children:"oo permit save"})," - Grant Permissions"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Usage:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"oo permit save <permit-file.yaml>\noo permit save <permits-directory>\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Single Permit Example:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'# api-access-permit.yaml\nid: "payment-api-access"\npermissionId: "payment-svc:process"\nslugs:\n  - "order-service"\n  - "subscription-service"\nroles:\n  - "payment-svc:processor"\n'})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Multiple Permits Example:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'# service-permissions.yaml\n- id: "chat-read-permit"\n  permissionId: "chat-svc:message:read"\n  slugs: ["frontend-app", "mobile-app"]\n\n- id: "chat-write-permit"\n  permissionId: "chat-svc:message:create"\n  roles: ["chat-svc:user"]\n\n- id: "admin-chat-permit"\n  permissionId: "chat-svc:admin"\n  roles: ["user-svc:admin"]\n'})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Apply Permits:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Save single permit\noo permit save api-access-permit.yaml\n\n# Save multiple permits\noo permit save service-permissions.yaml\n\n# Save from directory\noo permit save permissions/production/\n"})}),"\n",(0,r.jsxs)(s.h4,{id:"oo-permit-list---view-permissions",children:[(0,r.jsx)(s.code,{children:"oo permit list"})," - View Permissions"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# List all permits (admin required)\noo permit list\n\n# Example output:\n# PERMIT ID          PERMISSION              SLUGS               ROLES\n# payment-api-access payment-svc:process     order-service       payment-svc:processor\n# chat-read-permit   chat-svc:message:read   frontend-app\n"})}),"\n",(0,r.jsx)(s.h3,{id:"enrollment",children:"Enrollment"}),"\n",(0,r.jsxs)(s.h4,{id:"oo-enroll-save---assign-roles",children:[(0,r.jsx)(s.code,{children:"oo enroll save"})," - Assign Roles"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Usage:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"oo enroll save <role> --userId <id>\noo enroll save <role> --contactId <email>\noo enroll save <enroll-file.yaml>\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Direct Enrollment:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Enroll user to admin role\noo enroll save user-svc:admin --userId usr_abc123\n\n# Enroll by email (future user)\noo enroll save payment-svc:processor --contactId alice@company.com\n\n# Organization role\noo enroll save user-svc:org:org_xyz789:admin --userId usr_def456\n"})}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"File-Based Enrollment:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'# team-enrollments.yaml\n- id: "admin-enrollment-1"\n  role: "user-svc:admin"\n  contactId: "admin@company.com"\n\n- id: "dev-team-enrollment"\n  role: "dev-team:developer"\n  contactId: "developer@company.com"\n\n- id: "payment-processor-enrollment"\n  role: "payment-svc:processor"\n  userId: "usr_abc123"\n'})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Apply enrollments\noo enroll save team-enrollments.yaml\n"})}),"\n",(0,r.jsxs)(s.h4,{id:"oo-enroll-list---view-enrollments",children:[(0,r.jsx)(s.code,{children:"oo enroll list"})," - View Enrollments"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Usage:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"oo enroll list [--role role] [--userId id] [--contactId email]\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Apply service permissions\noo permit save payment-service-permissions.yaml\n"})})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>t,x:()=>a});var i=n(96540);const r={},o=i.createContext(r);function t(e){const s=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(o.Provider,{value:s},e.children)}}}]);